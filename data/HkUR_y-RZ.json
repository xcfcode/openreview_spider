{"paper": {"title": "SEARNN: Training RNNs with global-local losses", "authors": ["R\u00e9mi Leblond", "Jean-Baptiste Alayrac", "Anton Osokin", "Simon Lacoste-Julien"], "authorids": ["remi.leblond@inria.fr", "jean-baptiste.alayrac@inria.fr", "aosokin@hse.ru", "slacoste@iro.umontreal.ca"], "summary": "We introduce SeaRNN, a novel algorithm for RNN training, inspired by the learning to search approach to structured prediction, in order to avoid the limitations of MLE training.", "abstract": "We propose SEARNN, a novel training algorithm for recurrent neural networks (RNNs) inspired by the \"learning to search\" (L2S) approach to structured prediction. RNNs have been widely successful in structured prediction applications such as machine translation or parsing, and are commonly trained using maximum likelihood estimation (MLE). Unfortunately, this training loss is not always an appropriate surrogate for the test error: by only maximizing the ground truth probability, it fails to exploit the wealth of information offered by structured losses. Further, it introduces discrepancies between training and predicting (such as exposure bias) that may hurt test performance. Instead, SEARNN leverages test-alike search space exploration to introduce global-local losses that are closer to the test error. We first demonstrate improved performance over MLE on two different tasks: OCR and spelling correction. Then, we propose a subsampling strategy to enable SEARNN to scale to large vocabulary sizes. This allows us to validate the benefits of our approach on a machine translation task.", "keywords": ["Structured prediction", "RNNs"]}, "meta": {"decision": "Accept (Poster)", "comment": "This paper generally presents a nice idea, and some of the modifications to searn/lols that the authors had to make to work with neural networks are possibly useful to others. Some weaknesses exist in the evaluation that everyone seems to agree on, but disagree about importance (in particular, comparison to things like BLS and Mixer on problems other than MT).\n\nA few side-comments (not really part of meta-review, but included here anyway):\n- Treating rollin/out as a hyperparameter is not unique to this paper; this was also done by Chang et al., NIPS 2016, \"A credit assignment compiler...\"\n- One big question that goes unanswered in this paper is \"why does learned rollin (or mixed rollin) not work in the MT setting.\" If the authors could add anything to explain this, it would be very helpful!\n- Goldberg & Nivre didn't really introduce the _idea_ of dynamic oracles, they simply gave it that name (e.g., in the original Searn paper, and in most of the imitation learning literature, what G&n call a \"dynamic oracle\" everyone else just calls an \"oracle\" or \"expert\")"}, "review": {"S1KZ3x5ef": {"type": "review", "replyto": "HkUR_y-RZ", "review": "This paper extends the concept of global rather than local optimization from the learning to search (L2S) literature to RNNs, specifically in the formation and implementation of SEARNN. Their work takes steps to consider and resolve issues that arise from restricting optimization to only local ground truth choices, which traditionally results in label / transition bias from the teacher forced model.\n\nThe underlying issue (MLE training of RNNs) is well founded and referenced, their introduction and extension to the L2S techniques that may help resolve the issue are promising, and their experiments, both small and large, show the efficacy of their technique.\n\nI am also glad to see the exploration of scaling SEARNN to the IWSLT'14 de-en machine translation dataset. As noted by the authors, it is a dataset that has been tackled by related papers and importantly a well scaled dataset. For SEARNN and related techniques to see widespread adoption, the scaling analysis this paper provides is a fundamental component.\n\nThis reviewer, whilst not having read all of the appendix in detail, also appreciates the additional insights provided by it, such as including losses that were attempted but did not result in appreciable gains.\n\nOverall I believe this is a paper that tackles an important topic area and provides a novel and persuasive potential solution to many of the issues it highlights.\n\n(extremely minor typo: \"One popular possibility from L2S is go the full reduction route down to binary classification\")", "title": "Fascinating and well investigated extension of L2S to RNNs", "rating": "8: Top 50% of accepted papers, clear accept", "confidence": "4: The reviewer is confident but not absolutely certain that the evaluation is correct"}, "S1rKPVcgz": {"type": "review", "replyto": "HkUR_y-RZ", "review": "This paper proposes an adaptation of the SEARN algorithm to RNNs for generating text. In order to do so, they discuss various issues on how to scale the approach to large output vocabularies by sampling which actions the algorithm to explore.\n\nPros:\n- Good literature review. But the future work on bandits is already happening:\nPaper accepted at ACL 2017: Bandit Structured Prediction for Neural Sequence-to-Sequence Learning. Julia Kreutzer, Artem Sokolov, Stefan Riezler.\n\n\nCons:\n- The key argument of the paper is that SEARNN is a better IL-inspired algorithm than the previously proposed ones. However there is no direct comparison either theoretical or empirical against them. In the examples on spelling using the dataset of Bahdanau et al. 2017, no comparison is made against their actor-critic method. Furthermore, given its simplicity, I would expect a comparison against scheduled sampling.\n\n- A lot of important experimental details are in the appendices and they differ among experiments. For example, while mixed rollins are used in most experiments, reference rollins are used in MT, which is odd since it is a bad option theoretically. Also,  no details are given on how the mixing in the rollouts was tuned. Finally, in the NMT comparison while it is stated that similar architecture is used in order to compare fairly against previous work, this is not the case eventually, as it is acknowledged at least in the case of MIXER. I would have expected the same encoder-decoder architecture to have been used for all the methods considered.\n \n- the two losses introduced are not really new. The log-loss is just MLE, only assuming that instead of a fixed expert that always returns the same target, we have a dynamic one. Note that the notion of dynamic expert is present in the SEARN paper too. Goldberg and Nivre just adapted it to transition-based dependency parsing. Similarly, since the KL loss is the same as XENT, why give it a new name?\n\n- the top-k sampling method is essentially the same as the targeted exploration of Goodman et al. (2016) which the authors cite. Thus it is not a novel contribution.\n  \n- Not sure I see the difference between the stochastic nature of SEARNN and the online one of LOLS mentioned in section 7. They both could be mini-batched similarly. Also, not sure I see why SEARNN can be used on any task, in comparison to other methods. They all seem to be equally capable.\n\nMinor comments:\n- Figure 1: what is the difference between \"cost-sensitive loss\" and just \"loss\"?\n- local vs sequence-level losses: the point in Ranzato et al and Wiseman & Rush is that the loss they optimizise (BLEU/ROUGE) do not decompose over the the predictions of the RNNs.\n- Can't see why SEARNN can help with the vanishing gradient problem. Seem to be rather orthogonal.\n", "title": "Good ideas, but lack of comparison against previous work and unclear experiments", "rating": "5: Marginally below acceptance threshold", "confidence": "5: The reviewer is absolutely certain that the evaluation is correct and very familiar with the relevant literature"}, "SJEBLCSZM": {"type": "review", "replyto": "HkUR_y-RZ", "review": "The paper proposes new RNN training method based on the SEARN learning to search (L2S) algorithm and named as SeaRnn. It proposes a way of overcoming the limitation of local optimization trough the exploitation of the structured losses by L2S. It can consider different classifiers and loss functions, and a sampling strategy for making the optimization problem scalable is proposed. SeaRnn improves the results obtained by MLE training in three different problems, including a large-vocabulary machine translation. In summary, a very nice paper.\n\nQuality: SeaRnn is a well rooted and successful application of the L2S strategy to the RNN training that combines at the same time global optimization and scalable complexity. \n\nClarity: The paper is well structured and written, with a nice and well-founded literature review.\n\nOriginality: the paper presents a new algorithm for training RNN based on the L2S methodology, and it has been proven to be competitive in both toy and real-world problems.\n\nSignificance: although the application of L2S to RNN training is not new, the contribution to the overcoming the limitations due to error propagation and MLE training of RNN is substantial.\n", "title": "Successful application of L2S to RNN training", "rating": "7: Good paper, accept", "confidence": "3: The reviewer is fairly confident that the evaluation is correct"}, "HyM2dLTmG": {"type": "rebuttal", "replyto": "HkMLxA5Mf", "comment": "Loss name: \"But as you say, no novel losses are introduced, hence no new names are warranted.\"\n\nWe really apologize but we still don't understand why you are saying that we use a \"new name\" for our cost-sensitive loss. When naming the loss \"Kullback-Leibler divergence (KL)\", we are simply using the standard statistic term without any intention of using a new name for the sake of sounding more novel. We simply prefer the term 'KL' to the term 'XENT' for the reasons evoked in our previous reply. We also believe that using the term \u2018MLE\u2019 instead of \u2018logloss\u2019 would be detrimental to the general understanding of the method, as the MLE training mode of RNN refers to the traditional training mode. \n\nWe will be happy to revise our paper if you have an explicit recommendation on that point.\n\nPaper writing recommendation (see general answer).\n\nThanks again for all your feedback.", "title": "Specific comments (3/3)"}, "rJPavIa7G": {"type": "rebuttal", "replyto": "ByamFTczz", "comment": "Generality of SEARNN: \"But SEARNN is claimed to be widely applicable, thus I expect it to be consistently defined across tasks when compared to previous work\"\n\nYou are also concerned about the lack of generality of SEARNN due to the fact that the best rollin strategies are not always consistent within tasks. We believe this is not a problem as we consider SEARNN (as LOLS and SEARN) to be a meta algorithm, and the choice of rollin and rollout strategies to be hyperparameters of the method (similar to the mixing parameter in SEARN). We hope that this view addresses your concern.\n\nAbout the mixin rollout parameter: \"couldn't have known that this is the case for all experiments.\"\n\nWe have added that more explicitly (page 6, experiments paragraph). Sorry for the confusion. \n\n\"Similar architectures\": see general answer.\n", "title": "Specific comments (2/3)"}, "ry80LL6Qf": {"type": "rebuttal", "replyto": "SyoNr6cMG", "comment": "Theoretical comparisons: We also agree that having theoretical results such as the one presented in Chang's paper would be a nice addition to our paper. We leave this interesting developments as future work.\n\nExperimental comparison & paper writing: see general answer.\n\nHypothesis: Concerning our hypothesis \"Another possibility is that the underlying optimization problem becomes harder when using a learned rather than a reference roll-in.\", we want to stress again that we don't claim this is what happens but we are making what we think is a plausible conjecture. The optimization problem changes with the task and hence we don't see why our point is not valid even if we don't observe the same behavior for two different tasks.\n\nAlgorithm: see general answer.", "title": "Specific comments (1/3)"}, "Syk3BIa7M": {"type": "rebuttal", "replyto": "HkUR_y-RZ", "comment": "To begin with, we would like to express our gratitude for your very detailed comments to our response, which helped us understand the points in your initial review a lot better.\n\nWe have proceeded to a revision of the paper according to your comments in order to clarify and correct some of our claims. First, we are now more specific on the kind of tasks SEARNN can tackle (see notably page 9 last sentence). Second, we have added a specific comment about the difference in architecture with MIXER, and made explicit that a direct comparison is not meaningful (see footnote 2 page 8).  Third, we agree that there is a subtlety about the algorithm that can lead to a misunderstanding, especially in the context of reference roll-in. In order to improve the clarity of this point, we have been more explicit in the main paper (see Links to RNNs paragraph, section 3) and have added a description of how exactly a reference roll-in is achieved with an RNN (section A.3). The main point is that even for the reference roll-in strategy one still need to use the RNN in order to obtain the hidden states that will be used to initialize the roll-outs. The only difference is that the ground truth is passed to the next cell instead of the model's prediction (teacher forcing like). Finally, following your legitimate recommendation concerning the top-k strategy, we have added the citation to Goodman et al. and our statement at the moment we introduce it (Sampling strategies, page 7).\n\nFinally, we agree with you that the two additional experiments that you are requesting, namely running the actor critic method on our spelling dataset and running SEARNN on the MIXER architecture would be valuable additions to the paper. We will include them in a future revision as soon as we obtain results, but unfortunately we haven\u2019t yet had time to finish these experiments due to the holiday period and the length of training. We apologize for these setbacks.\nHowever, although they would add to the quality of the paper, we still believe that in its current form the paper already contains enough material to deserve publication.\n\nThank you again for your valuable feedback, which enables us to improve the quality of our paper. Note that we have answered other more specific points below your answers.", "title": "General answer to Reviewer 2"}, "BktgJQZMz": {"type": "rebuttal", "replyto": "B1hvAzWMf", "comment": "3. Novelty\n\n\"The two losses introduced are not really new.\"\n\"The top-k sampling method is essentially the same as the targeted exploration of Goodman et al. (2016) which the authors cite. Thus it is not a novel contribution.\"\n\nWe show that these assessments are the result of misunderstandings (in some cases we simply do not make novelty claims, and in others what we propose is actually different from the referred techniques).\n\nFirst, we want to reiterate the difference between a classical classification loss and a cost-sensitive loss, as these notions are fundamental to the whole field of L2S research. In a cost-sensitive classification problem, rather than having access to a single ground-truth output, one has access to a vector of costs, with one cost associated with each possible token. This unusual setup requires adapted losses. In particular, we are not aware of any other RNN training techniques which uses cost-sensitive losses, besides SeaRNN.\n\nSecond, concerning the log-loss (LL), we explain that it indeed shares the structure of MLE, and replaces constant experts by dynamic ones (see \u2018Log-loss\u2019 in Section 4). We also point out that this technique is not new, even in the context of RNN training (see our reference to Ballesteros et al, (2016) in 'L2S-inspired approaches' in the Discussion section at the bottom of page 9). We do not make novelty claims in that respect.\nHowever, to our knowledge this is the first algorithm which uses the scores obtained by roll-outs to determine the value of the dynamic expert. This is the aspect of the loss which we consider to be novel.\nIf our claim is unclear we can definitely rephrase it in a way that the reviewer deems more satisfactory.\n\nThird, we are not sure we understand the remark of the reviewer concerning the KL loss. In our setting, the KL divergence and the cross-entropy are indeed equivalent since the additional entropy term in XENT is constant with respect to the parameters of the model. We decided to call it KL as we saw this loss term as a divergence between two probability distributions (and indeed we tried several other divergences, see Appendix C).\nMLE can be thought of as a cross-entropy term between the model output and a Dirac distribution centered on the ground truth target.\nHowever, the difference in our setup is that we have access to a richer, non-Dirac target distribution, which we derive from the cost vectors. The novelty in our loss resides in the application of the KL divergence (or equivalently cross-entropy) in a situation where one has access to a full probabilistic distribution over the tokens in the vocabulary instead of a single target output.\n\nFinally, the top-k strategy is a simplified version of targeted sampling. Indeed, none of the strategies we test (uniform, topk, policy sampling and biased policy sampling) are novel. We acknowledge this in the main text of the paper and we make no claims about novelty with respect to these strategies.\n\nConclusion\nWe believe we have alleviated a number of concerns and clarified some misunderstandings which lead to unfavorable assessments about the paper. In light of these clarifications, we hope the reviewer will consider adjusting their evaluation accordingly, and helping us improve the paper through suggestions.\n\n\nReferences:\nDzmitry Bahdanau, Philemon Brakel, Kelvin Xu, Anirudh Goyal, Ryan Lowe, Joelle Pineau, Aaron Courville, and Yoshua Bengio. An actor-critic algorithm for sequence prediction. In ICLR, 2017.\nMiguel Ballesteros, Yoav Goldberg, Chris Dyer, and Noah A Smith. Training with exploration improves a greedy stack-LSTM parser. In EMNLP, 2016.\nSamy Bengio, Oriol Vinyals, Navdeep Jaitly, and Noam Shazeer. Scheduled sampling for sequence prediction with recurrent neural networks. In NIPS, 2015.\nKai-Wei Chang, Akshay Krishnamurthy, Alekh Agarwal, Hal Daum\u00e9, III, and John Langford. Learning to search better than your teacher. In ICML, 2015.\nHal Daum\u00e9, III, John Langford, and Daniel Marcu. Search-based structured prediction. Machine Learning, 2009.\nMarc\u2019Aurelio Ranzato, Sumit Chopra, Michael Auli, and Wojciech Zaremba. Sequence level training with recurrent neural networks. In ICLR, 2016.\nWen Sun, Arun Venkatraman, Geoffrey J. Gordon, Byron Boots, and J. Andrew Bagnell. Deeply aggrevated: Differentiable imitation learning for sequential prediction. In ICML, 2017.\nSam Wiseman and Alexander M Rush. Sequence-to-sequence learning as beam-search optimization. In EMNLP, 2016.", "title": "Authors' response (3/3)"}, "B1hvAzWMf": {"type": "rebuttal", "replyto": "S1YZ0GbzG", "comment": "2. Experimental details\n\n\"A lot of important experimental details are in the appendices and they differ among experiments. \u00bb\n\"For example, while mixed rollins are used in most experiments, reference rollins are used in MT, which is odd since it is a bad option theoretically.\"\n\"Also, no details are given on how the mixing in the rollouts was tuned.\"\n\"Finally, in the NMT comparison while it is stated that similar architecture is used in order to compare fairly against previous work, this is not the case eventually, as it is acknowledged at least in the case of MIXER.\"\n\nThe reviewer points out that our experimental setup is unclear. We disagree with that statement and show in the following that all of the relevant information can be found in the main text of the paper and that differences are underlined and analyzed in details. We will strive to present this information more clearly.\n\nFirst off, let us point out that there are no mixed roll-ins in any of the experiments. We compare reference and learned roll-ins for OCR and Spelling (see Table 1 and the caption of Table 2), and use reference roll-ins for NMT, as stated at the beginning of Section 6 (in the middle of page 8) and at the end of this section (see bottom of page 8).\n\nSecond, while L2S theory indeed tells us that a learned roll-in should always be preferred to a reference one, on some datasets practitioners observe the reverse. We confirmed this with the authors of the SEARN paper (Daum\u00e9 et al, 2009) through private communication.\nWe provide potential explanations in the main text of the paper (see Key takeaways in Section 6, bottom of page 8), namely:\n\n- either our reference policy is too weak to provide good enough training signal\n- or the problem obtained with a learned roll-in might be harder to optimize for than its equivalent obtained with a reference roll-in -- an issue which is overlooked by classical L2S theory.\n\nWe also explain what choice of hyper parameter we advocate, including resorting to a reference roll-in when a learned roll-in does not lead to good performance (see 'Traditional L2S approches', Section 7, top of page 9).\nWe therefore argue that this choice in hyper parameter is made explicit and is motivated in the paper.\n\nThird, the value of the mix-in probability for our roll-outs (0.5) is reported in the caption underneath Table 1. It is the same for all datasets. We do not report any tuning of this value because we did not perform any. We followed Chang et al (2015), where the authors indicate that their algorithm is not sensitive to this value, so we did not feel the need to optimize for it. We will add this reasoning to the paper to explain the value we took.\n\nFinally, we do indeed use an architecture that is different from that of MIXER. This information is reported in the main text (see Key takeaways in Section 6), as we are explicit about the architectures of related methods. The reason for this difference is that we decided to reuse the architecture used both by BSO and by Actor-Critic. We have followed their setup as closely as possible, and are not aware of any meaningful difference with our own. If our presentation is not clear enough, we are happy to add this information at any place the reviewer sees fit.\n\nOnce again, we stress that all of this information is presented *in the main text*, and discussed at length. The only thing present in the appendix is an expanded version of the harder optimization problem hypothesis we make in 'Key takeaways' in Section 6.", "title": "Authors' response (2/3)"}, "S1YZ0GbzG": {"type": "rebuttal", "replyto": "S1rKPVcgz", "comment": "Reviewer2 provides an in-depth and thoughtful review. They express concerns about three potential issues: a lack of comparison to related methods, unclear experiments and erroneous novelty claims. We believe these criticisms stem for the most part from several key misunderstandings about the presented method and the claims made in the paper.\nIn the following, we make explicit these misunderstandings and we strive to clarify them.\nWe hope that reviewer 2 can help us improve the paper by pointing out the specific parts that they found confusing.\n\n1. How does SeaRNN relate to other IL-inspired algorithms?\n\n\"The key argument of the paper is that SEARNN is a better IL-inspired algorithm than the previously proposed ones. However there is no direct comparison either theoretical or empirical against them.\"\n\nWe disagree with this statement and show in the following that the paper does indeed contain both theoretical and empirical comparisons, including a section (Discussion, Section 7) about theoretical comparison to related methods and a large-scale experiment where the performance of various methods is compared.\n\nFirst off, the main aim of the paper is to introduce a novel IL-inspired method for training RNNs which alleviates the issues associated with traditional MLE training. We then contrast different methods and explore their pros and cons. These concrete elements of comparison, both theoretical and empirical, lead us to believe that SeaRNN is indeed well-positioned.\n\nTheoretical comparisons:\nAs part of this exploration, we provide numerous theoretical points of comparison in the Discussion section (Section 7):\n\n- we compare with schedule sampling (Bengio et al, 2015). They use a mixed roll-in, while we use either a reference or a learned roll-in. Furthermore, SeaRNN leverages roll-outs for estimation and custom losses, while schedule sampling simply uses the MLE loss.\n- we underline an important difference between SeaRNN and most related methods (be they RL-inspired e.g. MIXER (Ranzato et al, 2016) and Actor-Critic (Bahdanau et al, 2017) or IL-inspired e.g. BSO (Wiseman et al, 2016)): the fact that since the training signal from their loss is quite sparse, they have to use warm starting, whereas SeaRNN does not.\n- we remark that BSO requires being able to compute the evaluation metric on unfinished sequences (see the definition of the associated loss in (Wiseman and Rush, 2016, Section 4.1)). While this is technically possible for BLEU, the scores obtained this way are arguably not meaningful. In contrast, SeaRNN always computes scores on full sequences.\n- we explain that some IL-inspired methods (see Ballesteros et al, 2016 and Sun et al, 2017) require a free cost-to-go oracle, whereas SeaRNN uses roll-outs for exploration and is thus more widely applicable, albeit at a higher computational cost.\n- Incidentally, the last two points explain why we write that SeaRNN can be used on a wider amount of tasks, compared to some related methods.\n\nEmpirical comparisons:\n\"In the examples on spelling using the dataset of Bahdanau et al. 2017, no comparison is made against their actor-critic method. Furthermore, given its simplicity, I would expect a comparison against scheduled sampling. \u00bb\n\nAs we explain in the caption of Table 1, we cannot directly compare SeaRNN to Actor-Critic on the Spelling dataset, because the authors of this paper used a random test dataset and some key hyper parameters are missing from the open source implementation (we obtained this information through private communication with them when first trying to compare our methods).\nWe do provide a point of comparison with Actor-Critic (with the same architecture) on a larger scale dataset, namely IWSLT'14 de-en MT.\nFinally, we conducted thorough experiments with scheduled sampling on the NMT dataset. Unfortunately, we could not obtain any significant improvement over MLE, even with a careful schedule proposed by the authors of the scheduled sampling paper through private communication (note that no positive results on NMT were reported in the original paper either). This is reported in the main text of the paper (see Key takeaways in Section 6, at the bottom of page 8).\nIf the reviewer believes this would add to the paper, we will of course run this algorithm on the OCR and Spelling datasets and report the obtained results (we have not conducted these experiments yet).\n\nAll told, we believe our paper does present theoretical and empirical comparisons to related methods. We have already conducted and reported on some of the experiments the reviewer asks for.", "title": "Authors' response (1/3)"}, "BJWspGbzz": {"type": "rebuttal", "replyto": "HkUR_y-RZ", "comment": "We thank the reviewers for their thorough and detailed evaluations. We are grateful for all the positive feedback given by the reviewers and their suggestions.\nReviewer 2 expresses some concerns about the paper which seem due to several misunderstandings; we clarify these in a specific response.", "title": "Authors' response"}}}